#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ SSH –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ GitHub
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ: chmod +x setup-ssh-auth.sh && ./setup-ssh-auth.sh

echo "üîë –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSH –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ GitHub..."
echo ""

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ SSH –∫–ª—é—á–∏
if [ -f ~/.ssh/id_ed25519 ]; then
    echo "‚úÖ SSH –∫–ª—é—á —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç: ~/.ssh/id_ed25519"
    echo "üìã –ü—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á:"
    cat ~/.ssh/id_ed25519.pub
    echo ""
    echo "üí° –ï—Å–ª–∏ —ç—Ç–æ—Ç –∫–ª—é—á —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω –≤ GitHub, –º–æ–∂–Ω–æ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ"
    read -p "–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –∫–ª—é—á? (y/N): " create_new
    if [[ $create_new != "y" && $create_new != "Y" ]]; then
        echo "–ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∫–ª—é—á–∞"
    else
        create_new_key=true
    fi
else
    create_new_key=true
fi

if [ "$create_new_key" = true ]; then
    echo "üîß –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –Ω–æ–≤—ã–π SSH –∫–ª—é—á..."
    ssh-keygen -t ed25519 -C "deser7@icloud.com" -f ~/.ssh/id_ed25519 -N ""
    
    if [ $? -eq 0 ]; then
        echo "‚úÖ SSH –∫–ª—é—á —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ!"
    else
        echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ SSH –∫–ª—é—á–∞"
        exit 1
    fi
fi

# –ó–∞–ø—É—Å–∫–∞–µ–º ssh-agent
echo "üöÄ –ó–∞–ø—É—Å–∫–∞–µ–º ssh-agent..."
eval "$(ssh-agent -s)"

# –î–æ–±–∞–≤–ª—è–µ–º –∫–ª—é—á –≤ ssh-agent
echo "üîë –î–æ–±–∞–≤–ª—è–µ–º –∫–ª—é—á –≤ ssh-agent..."
ssh-add ~/.ssh/id_ed25519

# –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á
echo ""
echo "üìã –ü—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á (–¥–æ–±–∞–≤—å –µ–≥–æ –≤ GitHub):"
echo "=========================================="
cat ~/.ssh/id_ed25519.pub
echo "=========================================="
echo ""

echo "üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—é –∫–ª—é—á–∞ –≤ GitHub:"
echo ""
echo "1. –°–∫–æ–ø–∏—Ä—É–π –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –≤—ã—à–µ"
echo "2. –û—Ç–∫—Ä–æ–π GitHub: https://github.com"
echo "3. –í–æ–π–¥–∏ –≤ –∞–∫–∫–∞—É–Ω—Ç (Deser7)"
echo "4. –ü–µ—Ä–µ–π–¥–∏ –≤ Settings -> SSH and GPG keys"
echo "5. –ù–∞–∂–º–∏ 'New SSH key'"
echo "6. –í–≤–µ–¥–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ: 'MacBook-Natasa'"
echo "7. –í—Å—Ç–∞–≤—å –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –≤ –ø–æ–ª–µ 'Key'"
echo "8. –ù–∞–∂–º–∏ 'Add SSH key'"
echo ""

read -p "–ù–∞–∂–º–∏ Enter –∫–æ–≥–¥–∞ –¥–æ–±–∞–≤–∏—à—å –∫–ª—é—á –≤ GitHub..."

# –ú–µ–Ω—è–µ–º URL —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –Ω–∞ SSH
echo "üîß –ú–µ–Ω—è–µ–º URL —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –Ω–∞ SSH..."
git remote set-url origin git@github.com:Deser7/TestWorldClassSaratov.git

echo ""
echo "üß™ –¢–µ—Å—Ç–∏—Ä—É–µ–º SSH –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ..."

# –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ GitHub
if ssh -T git@github.com; then
    echo "‚úÖ SSH –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!"
    echo "üéâ –¢–µ–ø–µ—Ä—å —Ç—ã –º–æ–∂–µ—à—å push/pull –±–µ–∑ –≤–≤–æ–¥–∞ –ø–∞—Ä–æ–ª—è"
else
    echo "‚ùå –û—à–∏–±–∫–∞ SSH –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏"
    echo "üí° –£–±–µ–¥–∏—Å—å, —á—Ç–æ –∫–ª—é—á –¥–æ–±–∞–≤–ª–µ–Ω –≤ GitHub"
fi

echo ""
echo "üìù –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:"
echo "  git push origin Network    - –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è"
echo "  git pull origin Network    - –ø–æ–ª—É—á–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è"
echo "  git fetch origin           - –æ–±–Ω–æ–≤–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤–µ—Ç–∫–∞—Ö"
echo ""
echo "üîí SSH –∫–ª—é—á —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ ~/.ssh/id_ed25519"
echo "üí° –ö–ª—é—á –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ ssh-agent –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ" 